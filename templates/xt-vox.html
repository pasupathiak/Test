<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XT-VoX AI</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .chat-container {
        height: calc(100vh - 140px);
      }
      .message-area {
        height: calc(100% - 60px);
        overflow-y: auto;
      }
      .typing-indicator span {
        animation: blink 1.4s infinite both;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes blink {
        0% {
          opacity: 0.1;
        }
        20% {
          opacity: 1;
        }
        100% {
          opacity: 0.1;
        }
      }
.logo {
    width: 45%;
    height: auto;
    margin-bottom: 10px;
}
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="flex h-screen bg-gray-100">
      <!-- Sidebar -->
      <div class="w-64 bg-white shadow-md flex flex-col">
        <div class="p-4 border-b border-gray-200 flex items-center justify-center space-x-3">
    <!-- Logo Image -->
    <img src="static/logo.png" alt="XT-VoX AI Logo" class="w-16 h-11">

    <!-- Title -->
    <h1 class="text-xl font-bold text-blue-600">XT-VoX AI</h1>
</div>


       <div class="p-2 flex justify-center">
    <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold rounded-full shadow-md transition-transform transform hover:scale-105 focus:outline-none">
       New Conversation
    </button>
</div>

        <div class="flex-1 overflow-y-auto p-2">
          <div class="p-3 bg-blue-100 rounded-md mb-2 cursor-pointer">
            Product Inquiry
          </div>
          <!-- <div class="p-3 hover:bg-gray-100 rounded-md mb-2 cursor-pointer">
            Technical Support
          </div>
          <div class="p-3 hover:bg-gray-100 rounded-md mb-2 cursor-pointer">
            Feature Request
          </div> -->
        </div>
        <div class="p-4 border-t border-gray-200">
          <div class="flex items-center">
            <div
              class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
            >
              XT
            </div>
            <div class="ml-2">
              <div class="text-sm font-medium">Vox User</div>
              <div class="text-xs text-gray-500">admin@xyloite.com</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Chat Area -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <div
          class="h-16 bg-white shadow-sm flex items-center justify-between px-4"
        >
          <h2 class="text-lg font-medium">Product Inquiry</h2>
<!-- <a href="#" class="support-link px-4 py-2 hover:bg-blue-600 active:bg-blue-700 focus:outline-none focus:ring focus:ring-blue-300 transition-all duration-300">
    Support
</a>
<button class="p-2 rounded-full hover:bg-gray-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
          </button> -->
          <div class="flex justify-end items-center space-x-4 p-4">
    <!-- Support Link -->
    <a href="#" class="support-link px-4 py-2 hover:bg-blue-600 active:bg-blue-700 focus:outline-none focus:ring focus:ring-blue-300 transition-all duration-300">
        Support
    </a>

    <!-- Button with Icon -->
    <button class="p-2 rounded-full hover:bg-gray-200">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/>
        </svg>
    </button>
</div>


        </div>
        <div class="chat-container flex-1 overflow-hidden bg-gray-50 p-4">
          <div id="message-area" class="message-area">
            <div class="flex mb-4">
              <div class="flex items-start max-w-3/4">
                <div
                  class="w-8 h-8 rounded-full bg-green-500 mr-2 flex items-center justify-center"
                >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.2 6.27L20 9.46l-4.47 4.1 1.06 6.4L12 17.23l-5.59 2.73 1.06-6.4L3 9.46l5.8-1.19z"/><circle cx="12" cy="12" r="10"/></svg>
                </div>
                <div class="p-3 bg-gray-100 rounded-lg">
                  <div class="text-sm">Hello! How can I assist you today?</div>
                </div>
              </div>
            </div>
          </div>
        </div>

<!-- Input Area -->
<div class="p-4 bg-white shadow-sm">
    <div class="flex items-center border border-gray-300 rounded-md px-2 py-1 focus-within:ring-2 focus-within:ring-blue-500">
        <!-- Mic Button -->
       <button id="mic-btn" class="p-2 focus:outline-none rounded-full transition relative">
    <!-- Static Glowing Circle Effect -->
    <span class="absolute inset-0 bg-blue-300 opacity-50 rounded-full scale-125"></span>

    <!-- Mic Icon -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700 relative" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18v3m0 0v-3m0 3h3m-3 0H9m6-9a3 3 0 01-6 0V5a3 3 0 016 0v6z" />
    </svg>
</button>


        
        <!-- Text Input (Highlighted in Blue) -->
        <input
            type="text"
            id="user-input"
            placeholder="Type your message..."
            class="flex-1 py-2 px-4 focus:outline-none text-blue-600 font-medium placeholder-gray-400 focus:ring-0 border-blue-500"
        />
        
        <!-- Send Button -->
       <button id="send-btn" class="p-2 focus:outline-none rounded-full transition relative">
    <!-- Static Glowing Circle Effect -->
    <span class="absolute inset-0 bg-blue-300 opacity-50 rounded-full scale-125"></span>

    <!-- Send Icon -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700 relative" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4l16 8-16 8V4z" />
    </svg>
</button>

    </div>
</div>




      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const inputField = document.getElementById("user-input");
        const sendButton = document.getElementById("send-btn");
        const micButton = document.getElementById("mic-btn");
        const messageArea = document.getElementById("message-area");

        document.getElementById("send-btn").addEventListener("click", () => {
    sendMessage(document.getElementById("user-input").value);
});

document.getElementById("user-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
        sendMessage(document.getElementById("user-input").value);
    }
});


        function appendMessage(sender, text) {
    const msgDiv = document.createElement("div");
    msgDiv.classList.add("flex", "mb-4");

    // Get current time
    const now = new Date();
    const hours = now.getHours() % 12 || 12; // Convert to 12-hour format
    const minutes = now.getMinutes().toString().padStart(2, "0");
    const ampm = now.getHours() >= 12 ? "PM" : "AM";
    const timestamp = `${hours}:${minutes} ${ampm}`;

    // AI Message (Left Side)
    if (sender === "bot") {
        msgDiv.innerHTML = `
            <div class="flex items-start max-w-3/4">
                <div class="w-8 h-8 rounded-full bg-green-500 mr-2 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.2 6.27L20 9.46l-4.47 4.1 1.06 6.4L12 17.23l-5.59 2.73 1.06-6.4L3 9.46l5.8-1.19z"/><circle cx="12" cy="12" r="10"/></svg>
                  </div>
                <div class="p-3 bg-gray-100 rounded-lg">
                    <div class="text-sm">${text}</div>
                    <div class="text-xs text-gray-500 mt-1">${timestamp}</div>
                </div>
            </div>
        `;
    } 
    // User Message (Right Side)
    else {
        msgDiv.classList.add("justify-end");
        msgDiv.innerHTML = `
            <div class="flex items-start max-w-3/4 justify-end">
                <div class="p-3 bg-blue-100 rounded-lg">
                    <div class="text-sm">${text}</div>
                    <div class="text-xs text-gray-500 mt-1 text-right">${timestamp}</div>
                </div>
                <div class="w-8 h-8 rounded-full bg-blue-500 ml-2 flex items-center justify-center text-white">👤</div>
            </div>
        `;
    }

    messageArea.appendChild(msgDiv);
    messageArea.scrollTop = messageArea.scrollHeight;

    if (sender === "bot") {
        speakText(text);
    }
}


        function sendMessage(message) {
          if (!message.trim()) return;

          appendMessage("user", message);
          inputField.value = "";

          // Show typing indicator
          const typingDiv = document.createElement("div");
          typingDiv.classList.add("flex", "mb-4");
          typingDiv.innerHTML = `
                <div class="p-3 bg-gray-100 rounded-lg">
                    <div class="text-sm typing-indicator">
                        <span>●</span> <span>●</span> <span>●</span>
                    </div>
                </div>
            `;
          messageArea.appendChild(typingDiv);
          messageArea.scrollTop = messageArea.scrollHeight;

          fetch("/myapp/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
          })
            .then((response) => response.json())
            .then((data) => {
              typingDiv.remove();
              appendMessage("bot", data.response);
            })
            .catch((error) => {
              console.error("❌ Error fetching response:", error);
              typingDiv.remove();
              appendMessage("bot", "⚠️ Error connecting to server.");
            });
        }

        function speakText(text) {
          if ("speechSynthesis" in window) {
            const speech = new SpeechSynthesisUtterance(text);
            speech.lang = "en-US";
            window.speechSynthesis.speak(speech);
          } else {
            console.error("Text-to-Speech not supported.");
          }
        }

     function startVoiceRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
        alert("Speech recognition is not supported in this browser.");
        return;
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onstart = () => {
        micButton.classList.add("bg-red-500"); // Indicate listening
    };

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        console.log("🎤 Recognized Voice Input:", transcript);
        
        // Send message with "🎤 Voice Message" label
        sendMessage(`🎤 ${transcript}`);
    };

    recognition.onerror = (event) => {
        console.error("❌ Speech recognition error:", event.error);
    };

    recognition.onend = () => {
        micButton.classList.remove("bg-red-500"); // Reset button color
    };
}


        sendButton.addEventListener("click", () =>
          sendMessage(inputField.value)
        );
        micButton.addEventListener("click", startVoiceRecognition);
        inputField.addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendMessage(inputField.value);
        });
      });
    </script>
  </body>
</html>
